(function(){"use strict";var t={8037:function(t,e,i){var s=i(9242),n=i(3396);function o(t,e,i,s,o,a){const l=(0,n.up)("NavigatorComponent"),r=(0,n.up)("LibraryComponent"),d=(0,n.up)("WriterComponent");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(l),(0,n.Wm)(r),(0,n.Wm)(d)],64)}var a=i(7139);const l=t=>((0,n.dD)("data-v-308a41da"),t=t(),(0,n.Cn)(),t),r={class:"navigator"},d=l((()=>(0,n._)("div",{class:"logo"},[(0,n._)("h1",null,"WEWO"),(0,n._)("p",null,"基于微服务架构的双链笔记应用"),(0,n._)("hr")],-1))),h={class:"user-info"},_={key:0,ref:"login_container"},c={key:0},u={key:1},p={key:2},g={key:3},k={key:4},f={key:1,ref:"user_info"},m=l((()=>(0,n._)("div",{class:"heatmap-calendar"},null,-1))),y={class:"view-container"},v=l((()=>(0,n._)("h3",null,"视图",-1))),w=l((()=>(0,n._)("b",null,"Y",-1))),b=l((()=>(0,n._)("b",null,"N",-1))),D=l((()=>(0,n._)("br",null,null,-1))),C=l((()=>(0,n._)("b",null,"Y",-1))),x=l((()=>(0,n._)("b",null,"N",-1))),U=l((()=>(0,n._)("br",null,null,-1))),Z=l((()=>(0,n._)("b",null,"Y",-1))),q=l((()=>(0,n._)("b",null,"N",-1))),O={class:"graph-container"},W=l((()=>(0,n._)("h3",null,"图谱",-1))),N={ref:"graph",id:"graph"},Y={class:"linked-notes-container"},j=l((()=>(0,n._)("h3",null,"反向链接",-1))),z={key:0},V=l((()=>(0,n._)("br",null,null,-1)));function T(t,e,i,o,l,T){return(0,n.wg)(),(0,n.iD)("div",r,[d,(0,n._)("div",h,[this.login_state?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",_,[(0,n._)("p",null,[(0,n.Uk)("用户："),(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>this.username=t),type:"text",maxlength:"16"},null,512),[[s.nr,this.username]])]),(0,n._)("p",null,[(0,n.Uk)("密码："),(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>this.password=t),type:"password",maxlength:"16"},null,512),[[s.nr,this.password]])]),(0,n._)("button",{onClick:e[2]||(e[2]=(...t)=>T.login&&T.login(...t))},"登入"),(0,n.Uk)(),(0,n._)("button",{onClick:e[3]||(e[3]=(...t)=>T.signup&&T.signup(...t))},"注册"),l.fail_not_empty?((0,n.wg)(),(0,n.iD)("div",c,"用户或密码不能为空")):(0,n.kq)("",!0),l.fail_wrong_info?((0,n.wg)(),(0,n.iD)("div",u,"登入失败，用户名或密码错误")):(0,n.kq)("",!0),l.fail_user_exists?((0,n.wg)(),(0,n.iD)("div",p,"注册失败，用户已存在")):(0,n.kq)("",!0),l.success_login?((0,n.wg)(),(0,n.iD)("div",g,"登入成功")):(0,n.kq)("",!0),l.success_signup?((0,n.wg)(),(0,n.iD)("div",k,"注册成功")):(0,n.kq)("",!0)],512)),this.login_state?((0,n.wg)(),(0,n.iD)("div",f,[(0,n._)("p",null,[(0,n.Uk)((0,a.zw)(this.username)+"（",1),(0,n._)("a",{onClick:e[4]||(e[4]=(...t)=>T.logout&&T.logout(...t))},"登出"),(0,n.Uk)("），一共有"+(0,a.zw)(this.notes.length)+"张卡片",1)])],512)):(0,n.kq)("",!0)]),m,(0,n._)("div",y,[v,(0,n._)("p",null,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>this.keyword=t),class:"search-input",type:"text"},null,512),[[s.nr,this.keyword]])]),this.display_ids?((0,n.wg)(),(0,n.iD)("a",{key:0,onClick:e[6]||(e[6]=(...t)=>this.toggle_display_ids&&this.toggle_display_ids(...t))},[(0,n.Uk)("切换卡片ID显示（"),w,(0,n.Uk)("/N）")])):(0,n.kq)("",!0),this.display_ids?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("a",{key:1,onClick:e[7]||(e[7]=(...t)=>this.toggle_display_ids&&this.toggle_display_ids(...t))},[(0,n.Uk)("切换卡片ID显示（Y/"),b,(0,n.Uk)("）")])),D,this.display_card_delete?((0,n.wg)(),(0,n.iD)("a",{key:2,onClick:e[8]||(e[8]=(...t)=>this.toggle_display_delete&&this.toggle_display_delete(...t))},[(0,n.Uk)("切换卡片删除显示（"),C,(0,n.Uk)("/N）")])):(0,n.kq)("",!0),this.display_card_delete?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("a",{key:3,onClick:e[9]||(e[9]=(...t)=>this.toggle_display_delete&&this.toggle_display_delete(...t))},[(0,n.Uk)("切换卡片删除显示（Y/"),x,(0,n.Uk)("）")])),U,this.cards_in_order?((0,n.wg)(),(0,n.iD)("a",{key:4,onClick:e[10]||(e[10]=(...t)=>this.toglle_cards_order&&this.toglle_cards_order(...t))},[(0,n.Uk)("卡片按时间排序（"),Z,(0,n.Uk)("/N)")])):(0,n.kq)("",!0),this.cards_in_order?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("a",{key:5,onClick:e[11]||(e[11]=(...t)=>this.toglle_cards_order&&this.toglle_cards_order(...t))},[(0,n.Uk)("卡片按时间排序（Y/"),q,(0,n.Uk)(")")]))]),(0,n._)("div",O,[W,(0,n._)("div",N,null,512)]),(0,n._)("div",Y,[j,0==this.linked_notes.length?((0,n.wg)(),(0,n.iD)("p",z,"没有卡片链接到这里")):(0,n.kq)("",!0),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(this.linked_notes,((t,e)=>((0,n.wg)(),(0,n.iD)("p",{class:"reverse-link",key:e},[(0,n.Uk)(" ["+(0,a.zw)(e+1)+"] "+(0,a.zw)(t.title),1),V,(0,n._)("a",null,"[#id:"+(0,a.zw)(t.id)+"]",1)])))),128))])])}i(7658);var I=i(4311),M=i(2996),P=i(1373),S=(0,P.Z)();const E=S;var $=E,F={name:"NavigatorComponent",data(){return{graph:null,graph_data:{nodes:[],links:[]},login_state:!1,username:"",password:"",fail_not_empty:!1,fail_wrong_info:!1,fail_user_exists:!1,success_login:!1,success_signup:!1,notes:[{id:"0000",title:"当前没有笔记",content:"当前没有笔记\n请先登陆"}],links:[],display_ids:!0,display_card_delete:!1,cards_in_order:!0,linked_notes:[],keyword:"",keywords:[]}},watch:{keyword:function(t){this.login_state&&($.emit("update_library",{notes:this.notes,links:this.links}),$.emit("keyword_change",t))}},mounted(){$.on("update_data",(()=>{this.update_notes()})),$.on("create_note",(t=>{I.Z.post("/note/create",{title:t.title,author:this.username,content:t.content}).then((e=>{var i=e.data.id,s=this.parse_links(i,t.content,this.username);I.Z.post("/graph/update",{links:s,author:this.username}).then((()=>{this.update_notes()})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)}))})),$.on("update_note",(t=>{I.Z.post("/note/update",{id:t.id,title:t.title,author:this.username,content:t.content}).then((e=>{var i=e.data.id,s=this.parse_links(i,t.content,this.username);I.Z.post("/graph/update",{links:s,author:this.username}).then((()=>{this.update_notes()})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)}))})),$.on("delete_note",(t=>{I.Z.post("/note/delete",{id:t.id}).then((t=>{var e=t.data.id;I.Z.post("/graph/delete",{note:e,author:this.username}).then((()=>{$.emit("focus_note",{note_id:"",note_content:"*我有些想法......*"}),this.update_notes()})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)}))})),$.on("update_reverse_links",(t=>{this.login_state&&I.Z.get("/graph/get_reverse_links",{params:{target:t,author:this.username}}).then((t=>{var e=t.data;this.linked_notes=[],e.forEach((t=>{let e=this.notes.find((e=>e.id==t.source));this.linked_notes.push({id:t.source,title:e.title})}))})).catch((t=>{console.log(t)}))})),$.on("update_local_graph",(t=>{if(this.update_graph(),""!=t){var e=[t];this.graph_data.links=this.graph_data.links.filter((i=>(i.source==t||i.target==t)&&(e.push(i.source),e.push(i.target),!0))),this.graph_data.nodes=this.graph_data.nodes.filter((t=>-1!=e.indexOf(t.id))),this.initGraph2D()}})),$.emit("update_login_state",this.login_state),$.emit("update_library",{notes:this.notes,links:this.links}),this.initGraph2D()},methods:{async initGraph2D(){this.graph=(0,M.Z)()(this.$refs.graph).graphData(this.graph_data).width(this.$refs.graph.parentElement.offsetWidth).height(this.$refs.graph.parentElement.offsetWidth).nodeAutoColorBy("id").onNodeClick((t=>{this.graph.centerAt(t.x,t.y,1e3)}))},login(){""==this.username||""==this.password?(this.clear_notifications(),this.fail_not_empty=!0):I.Z.post("/user/login",{userdata:{username:this.username,password:this.password}}).then((t=>{var e=t.data.result;"success"==e?(this.clear_notifications(),this.success_login=!0,this.login_state=!0,this.update_notes(),$.emit("update_login_state",this.login_state)):(this.clear_notifications(),this.fail_wrong_info=!0)}))},signup(){""==this.username||""==this.password?this.fail_not_empty=!0:I.Z.post("/user/signup",{userdata:{username:this.username,password:this.password}}).then((t=>{var e=t.data.result;"success"==e?(this.clear_notifications(),this.success_signup=!0):(this.clear_notifications(),this.fail_user_exists=!0)}))},logout(){this.login_state=!1,$.emit("update_login_state",this.login_state),this.username="",this.password="",this.notes=[],this.links=[],$.emit("update_library",{notes:this.notes,links:this.links}),this.clear_notifications()},clear_notifications(){this.success_login=!1,this.success_signup=!1,this.fail_not_empty=!1,this.fail_wrong_info=!1,this.fail_user_exists=!1},update_notes(){this.login_state&&I.Z.get("/note/get_all",{params:{author:this.username}}).then((t=>{this.notes=t.data,this.update_links()})).catch((t=>{console.log(t)}))},update_links(){this.login_state&&I.Z.get("/graph/get_all",{params:{author:this.username}}).then((t=>{this.links=t.data,$.emit("update_library",{notes:this.notes,links:this.links}),this.update_graph()})).catch((t=>{console.log(t)}))},toggle_display_ids(){this.display_ids=!this.display_ids,$.emit("toggle_display_ids",this.display_ids)},toggle_display_delete(){this.display_card_delete=!this.display_card_delete,$.emit("toggle_display_delete",this.display_card_delete)},toglle_cards_order(){this.notes.reverse(),$.emit("update_library",{notes:this.notes,links:this.links}),$.emit("keyword_change",this.keyword)},update_graph(){this.graph_data.nodes=[];for(let t=0;t<this.notes.length;t++)this.graph_data.nodes.push({id:this.notes[t].id,name:this.notes[t].title});this.graph_data.links=[];for(let t=0;t<this.links.length;t++)this.graph_data.links.push({source:this.links[t].source,target:this.links[t].target});this.initGraph2D()},parse_links(t,e,i){var s,n=/\[#id:\S+?]/g,o=[];while(null!=(s=n.exec(e)))o.push({source:t,target:s[0].substring(5,s[0].length-1),author:i});return o}}},G=i(89);const A=(0,G.Z)(F,[["render",T],["__scopeId","data-v-308a41da"]]);var H=A;const L=t=>((0,n.dD)("data-v-29e5441c"),t=t(),(0,n.Cn)(),t),K={class:"writer"},B=L((()=>(0,n._)("div",{class:"hello-word"}," 不写，就无法思考。「卢曼卡片盒笔记写作法」 ",-1))),X={class:"editing-info"},J={key:0},Q={key:1},R={key:2},tt={class:"note-editor"},et={class:"note-buttons"};function it(t,e,i,s,o,l){const r=(0,n.up)("v-md-editor");return(0,n.wg)(),(0,n.iD)("div",K,[B,(0,n._)("div",X,[""!=this.copied_id?((0,n.wg)(),(0,n.iD)("span",J,"已复制卡片ID #"+(0,a.zw)(this.copied_id),1)):""!=this.note_id?((0,n.wg)(),(0,n.iD)("span",Q,[(0,n.Uk)("你正在写卡片#"+(0,a.zw)(this.note_id)+"，想",1),(0,n._)("a",{onClick:e[0]||(e[0]=(...t)=>this.reset_id&&this.reset_id(...t))},"创作新卡片"),(0,n.Uk)("？")])):((0,n.wg)(),(0,n.iD)("span",R,"你将写一张新卡片，也可以右键任意卡片以编辑"))]),(0,n._)("div",tt,[(0,n.Wm)(r,{modelValue:o.note_content,"onUpdate:modelValue":e[1]||(e[1]=t=>o.note_content=t),mode:"edit",height:"190px","left-toolbar":"undo redo clear | h bold italic strikethrough quote | ul ol table hr | link image code","right-toolbar":"preview toc fullscreen","disabled-menus":[]},null,8,["modelValue"])]),(0,n._)("div",et,[(0,n._)("button",{id:"send-button",href:"",onClick:e[2]||(e[2]=(...t)=>l.send_note&&l.send_note(...t))},"放入卡片盒")])])}var st={name:"WriterComponent",mounted(){$.on("update_login_state",(t=>{this.login_state=t})),$.on("focus_note",(t=>{this.login_state&&(this.note_id=t.id,this.note_content=t.content,$.emit("update_reverse_links",t.id),$.emit("update_local_graph",t.id))})),$.on("copy_id_notify",(t=>{this.copied_id=t,clearTimeout(this.timer),this.timer=setTimeout((()=>{this.copied_id=""}),800)}))},data(){return{note_id:"",note_content:"*我有些想法......*",login_state:!1,timer:null,copied_id:""}},methods:{note_change(){console.log(this.note_content)},send_note(){var t=this.note_content.indexOf("\n"),e=this.note_content.substring(0,t);this.login_state?""==this.note_id?($.emit("create_note",{title:e,content:this.note_content}),this.note_content="*我有些想法......*"):($.emit("update_note",{id:this.note_id,title:e,content:this.note_content}),this.note_id="",this.note_content="*我有些想法......*"):alert("请先在左侧登入。")},reset_id(){this.note_id="",$.emit("update_local_graph",this.note_id)}}};const nt=(0,G.Z)(st,[["render",it],["__scopeId","data-v-29e5441c"]]);var ot=nt;const at={class:"library"},lt=["onClick","onContextmenu"],rt={key:0,class:"card-id"},dt=["onClick"];function ht(t,e,i,o,l,r){const d=(0,n.up)("v-md-editor"),h=(0,n.up)("VueFlexWaterfall");return(0,n.wg)(),(0,n.iD)("div",at,[(0,n.Wm)(h,{class:"cards",col:"3","col-spacing":"15","break-at":{600:2,300:1}},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.cards,((t,i)=>((0,n.wg)(),(0,n.iD)("div",{class:"card-container",key:i,onClick:(0,s.iM)((e=>this.copy_note_id(t)),["left"]),onContextmenu:[(0,s.iM)((e=>this.focus_note(t)),["right"]),e[0]||(e[0]=(0,s.iM)((()=>{}),["right","prevent"]))]},[(0,n.Wm)(d,{"model-value":t.content,mode:"preview"},null,8,["model-value"]),this.display_ids?((0,n.wg)(),(0,n.iD)("p",rt,"id:"+(0,a.zw)(t.id),1)):(0,n.kq)("",!0),this.display_delete_cards?((0,n.wg)(),(0,n.iD)("button",{key:1,class:"card-delete",onClick:e=>this.try_delete_card(t)}," X ",8,dt)):(0,n.kq)("",!0)],40,lt)))),128))])),_:1})])}var _t=i(4475),ct={name:"LibraryComponent",data(){return{cards:[{id:"0000",title:"当前没有笔记",content:"当前没有笔记\n请先登陆"}],links:[],display_ids:!0,display_delete_cards:!1,keyword:""}},mounted(){$.on("update_library",(t=>{this.cards=t.notes,this.links=t.links})),$.on("toggle_display_ids",(t=>{this.display_ids=t})),$.on("toggle_display_delete",(t=>{this.display_delete_cards=t})),$.on("keyword_change",(t=>{this.keyword=t,this.cards=this.cards.filter((t=>-1!=t.content.indexOf(this.keyword)))}))},methods:{focus_note(t){$.emit("focus_note",t)},try_delete_card(t){$.emit("delete_note",t)},copy_note_id(t){this.$copyText("[#id:"+t.id+"]").then((()=>{$.emit("copy_id_notify",t.id)}),(()=>{console.log(t.id+" copy failed to clipboard")}))}},components:{VueFlexWaterfall:_t.F}};const ut=(0,G.Z)(ct,[["render",ht],["__scopeId","data-v-4ed1f507"]]);var pt=ut,gt={name:"App",components:{NavigatorComponent:H,WriterComponent:ot,LibraryComponent:pt}};const kt=(0,G.Z)(gt,[["render",o]]);var ft=kt,mt=i(6723),yt=i(7709),vt=i.n(yt),wt=i(164),bt=i.n(wt),Dt=i(187),Ct=i.n(Dt),xt=i(5428),Ut=i.n(xt);vt().use(bt(),{Prism:Ct()});const Zt=(0,s.ri)(ft).use(mt.hv).use(vt()).use(Ut());Zt.mount("#app"),Zt.config.globalProperties.$axios=I.Z.create({timeout:3e3})}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,i),o.exports}i.m=t,function(){var t=[];i.O=function(e,s,n,o){if(!s){var a=1/0;for(h=0;h<t.length;h++){s=t[h][0],n=t[h][1],o=t[h][2];for(var l=!0,r=0;r<s.length;r++)(!1&o||a>=o)&&Object.keys(i.O).every((function(t){return i.O[t](s[r])}))?s.splice(r--,1):(l=!1,o<a&&(a=o));if(l){t.splice(h--,1);var d=n();void 0!==d&&(e=d)}}return e}o=o||0;for(var h=t.length;h>0&&t[h-1][2]>o;h--)t[h]=t[h-1];t[h]=[s,n,o]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,s){var n,o,a=s[0],l=s[1],r=s[2],d=0;if(a.some((function(e){return 0!==t[e]}))){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(r)var h=r(i)}for(e&&e(s);d<a.length;d++)o=a[d],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(h)},s=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(8037)}));s=i.O(s)})();
//# sourceMappingURL=app.f4554c7b.js.map